{
  "version": 3,
  "sources": ["wrangler-modules-watch:wrangler:modules-watch", "../../../node_modules/wrangler/templates/modules-watch-stub.js", "../../../src/services/param-parser.ts", "../../../src/services/r2-storage.ts", "../../../src/config/models.ts", "../../../src/services/image-generator.ts", "../bundle-XpX3da/middleware-loader.entry.ts", "../bundle-XpX3da/middleware-insertion-facade.js", "../../../src/index.ts", "../../../src/endpoints/openai-endpoint.ts", "../../../src/endpoints/mcp-endpoint.ts", "../../../src/endpoints/frontend.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "C:\\Users\\tys\\Documents\\Coding\\cloudflare-image-mcp\\workers\\.wrangler\\tmp\\dev-RlyIIR",
  "sourcesContent": ["", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "// ============================================================================\n// Parameter Parser - Parses --key=value syntax from prompt\n// Supports both prompt-embedded parameters and standard JSON fields\n// ============================================================================\n\nimport type { ParsedParams, ModelConfig } from '../types.js';\n\nexport class ParamParser {\n  /**\n   * Parse parameters from prompt with --key=value syntax\n   * Also merges with explicit JSON fields\n   *\n   * Examples:\n   * - \"cyberpunk cat --steps=6 --seed=12345\"\n   * - \"portrait photo --width=512 --height=768 --guidance=8.5\"\n   * - \"surreal landscape --n=3\" (for multiple images)\n   */\n  static parse(\n    input: string | Record<string, any>,\n    explicitParams: Record<string, any> = {},\n    modelConfig?: ModelConfig\n  ): ParsedParams {\n    // Handle object input (OpenAI JSON format)\n    if (typeof input === 'object' && input !== null) {\n      return this.parseObject(input, modelConfig);\n    }\n\n    // Handle string input with --key=value syntax\n    if (typeof input === 'string') {\n      return this.parseString(input, explicitParams, modelConfig);\n    }\n\n    throw new Error(`Invalid input type: ${typeof input}`);\n  }\n\n  /**\n   * Parse a string with embedded parameters\n   */\n  private static parseString(\n    raw: string,\n    explicitParams: Record<string, any>,\n    modelConfig?: ModelConfig\n  ): ParsedParams {\n    // Match --key=value or --key value patterns\n    const paramRegex = /--(\\w+)(?:=(.+?))?(?=\\s+--|\\s*$)/g;\n    const params: Record<string, string> = {};\n    let match;\n\n    // Extract pure prompt (everything before first --)\n    const promptMatch = raw.match(/^([^-]+?)(?=\\s+--)/);\n    const purePrompt = promptMatch ? promptMatch[1].trim() : raw;\n\n    // Parse embedded parameters\n    while ((match = paramRegex.exec(raw)) !== null) {\n      const key = match[1];\n      const value = match[2]?.trim() || 'true';\n      params[key.toLowerCase()] = value;\n    }\n\n    // Merge explicit params (higher priority) with embedded params\n    const mergedParams = { ...params, ...explicitParams };\n\n    // Parse and validate each parameter\n    const result: ParsedParams = {\n      prompt: purePrompt,\n      rawPrompt: raw,\n    };\n\n    // Standard parameters\n    if (mergedParams.n !== undefined) {\n      result.n = this.parseInteger(mergedParams.n, 1, 10, 'n');\n    }\n    if (mergedParams.size !== undefined) {\n      result.size = this.parseSize(mergedParams.size);\n    }\n    if (mergedParams.width !== undefined) {\n      result.width = this.parseInteger(mergedParams.width, 256, 2048, 'width');\n    }\n    if (mergedParams.height !== undefined) {\n      result.height = this.parseInteger(mergedParams.height, 256, 2048, 'height');\n    }\n\n    // Cloudflare-specific parameters\n    if (mergedParams.steps !== undefined) {\n      result.steps = this.parseInteger(mergedParams.steps, 1, modelConfig?.limits?.maxSteps || 50, 'steps');\n    }\n    if (mergedParams.num_steps !== undefined) {\n      result.steps = this.parseInteger(mergedParams.num_steps, 1, modelConfig?.limits?.maxSteps || 20, 'num_steps');\n    }\n    if (mergedParams.seed !== undefined) {\n      result.seed = this.parseInteger(mergedParams.seed, 0, Number.MAX_SAFE_INTEGER, 'seed');\n    }\n    if (mergedParams.guidance !== undefined) {\n      result.guidance = this.parseNumber(mergedParams.guidance, 1, 30, 'guidance');\n    }\n    if (mergedParams.negative_prompt !== undefined) {\n      result.negative_prompt = String(mergedParams.negative_prompt);\n    }\n    if (mergedParams.strength !== undefined) {\n      result.strength = this.parseNumber(mergedParams.strength, 0, 1, 'strength');\n    }\n\n    // Image inputs\n    if (mergedParams.image !== undefined) {\n      result.image_b64 = this.extractBase64(mergedParams.image);\n    }\n    if (mergedParams.image_b64 !== undefined) {\n      result.image_b64 = this.extractBase64(mergedParams.image_b64);\n    }\n    if (mergedParams.mask !== undefined) {\n      result.mask_b64 = this.extractBase64(mergedParams.mask);\n    }\n\n    // Apply model-specific limits\n    if (modelConfig) {\n      this.applyModelLimitsInPlace(result, modelConfig);\n    }\n\n    return result;\n  }\n\n  /**\n   * Parse object input (OpenAI JSON format)\n   */\n  private static parseObject(\n    obj: Record<string, any>,\n    modelConfig?: ModelConfig\n  ): ParsedParams {\n    const result: ParsedParams = {\n      prompt: obj.prompt || '',\n      rawPrompt: obj.prompt || '',\n    };\n\n    // Standard OpenAI parameters\n    if (obj.n !== undefined) {\n      result.n = this.parseInteger(obj.n, 1, 10, 'n');\n    }\n    if (obj.size !== undefined) {\n      result.size = this.parseSize(obj.size);\n      const [width, height] = result.size.split('x').map(Number);\n      result.width = width;\n      result.height = height;\n    }\n\n    // Cloudflare-specific parameters\n    if (obj.steps !== undefined) {\n      result.steps = this.parseInteger(obj.steps, 1, modelConfig?.limits?.maxSteps || 50, 'steps');\n    }\n    if (obj.num_steps !== undefined) {\n      result.steps = this.parseInteger(obj.num_steps, 1, modelConfig?.limits?.maxSteps || 20, 'num_steps');\n    }\n    if (obj.seed !== undefined) {\n      result.seed = this.parseInteger(obj.seed, 0, Number.MAX_SAFE_INTEGER, 'seed');\n    }\n    if (obj.guidance !== undefined) {\n      result.guidance = this.parseNumber(obj.guidance, 1, 30, 'guidance');\n    }\n    if (obj.negative_prompt !== undefined) {\n      result.negative_prompt = String(obj.negative_prompt);\n    }\n    if (obj.strength !== undefined) {\n      result.strength = this.parseNumber(obj.strength, 0, 1, 'strength');\n    }\n\n    // Image inputs\n    if (obj.image !== undefined) {\n      result.image_b64 = this.extractBase64(obj.image);\n    }\n    if (obj.image_b64 !== undefined) {\n      result.image_b64 = this.extractBase64(obj.image_b64);\n    }\n    if (obj.mask !== undefined) {\n      result.mask_b64 = this.extractBase64(obj.mask);\n    }\n\n    // Apply model-specific limits\n    if (modelConfig) {\n      this.applyModelLimitsInPlace(result, modelConfig);\n    }\n\n    return result;\n  }\n\n  /**\n   * Apply model-specific limits in place\n   */\n  private static applyModelLimitsInPlace(params: ParsedParams, model: ModelConfig): void {\n    const limits = model.limits;\n\n    if (params.width !== undefined) {\n      params.width = Math.max(limits.minWidth, Math.min(limits.maxWidth, params.width));\n    }\n    if (params.height !== undefined) {\n      params.height = Math.max(limits.minHeight, Math.min(limits.maxHeight, params.height));\n    }\n    if (params.steps !== undefined) {\n      params.steps = Math.max(1, Math.min(limits.maxSteps, params.steps));\n    }\n  }\n\n  /**\n   * Parse size string (e.g., \"1024x1024\")\n   */\n  private static parseSize(size: string): string {\n    const match = size.match(/^(\\d+)x(\\d+)$/);\n    if (!match) {\n      throw new Error(`Invalid size format: ${size}. Use WxH format (e.g., 1024x1024)`);\n    }\n    const width = parseInt(match[1], 10);\n    const height = parseInt(match[2], 10);\n    return `${width}x${height}`;\n  }\n\n  /**\n   * Parse integer with validation\n   */\n  private static parseInteger(value: any, min: number, max: number, name: string): number {\n    const parsed = parseInt(value, 10);\n    if (isNaN(parsed)) {\n      throw new Error(`Invalid ${name}: must be an integer`);\n    }\n    if (parsed < min || parsed > max) {\n      throw new Error(`${name} must be between ${min} and ${max}`);\n    }\n    return parsed;\n  }\n\n  /**\n   * Parse number with validation\n   */\n  private static parseNumber(value: any, min: number, max: number, name: string): number {\n    const parsed = parseFloat(value);\n    if (isNaN(parsed)) {\n      throw new Error(`Invalid ${name}: must be a number`);\n    }\n    if (parsed < min || parsed > max) {\n      throw new Error(`${name} must be between ${min} and ${max}`);\n    }\n    return parsed;\n  }\n\n  /**\n   * Extract base64 from data URI or raw base64 string\n   */\n  private static extractBase64(input: string): string {\n    if (input.startsWith('data:')) {\n      // Extract from data:image/png;base64,XXXXX\n      const match = input.match(/base64,(.+)$/);\n      if (!match) {\n        throw new Error('Invalid data URI format');\n      }\n      return match[1];\n    }\n    return input;\n  }\n\n  /**\n   * Convert parsed params to Cloudflare AI payload\n   */\n  static toCFPayload(params: ParsedParams, model: ModelConfig): Record<string, any> {\n    const payload: Record<string, any> = {\n      prompt: params.prompt,\n    };\n\n    // Map each supported parameter to its Cloudflare equivalent\n    for (const [key, config] of Object.entries(model.parameters)) {\n      const value = (params as any)[key];\n      if (value !== undefined && value !== null) {\n        payload[config.cfParam] = value;\n      }\n    }\n\n    return payload;\n  }\n\n  /**\n   * Format help text for a model\n   */\n  static formatHelp(model: ModelConfig): string {\n    const lines = [`## ${model.name} Parameters`, ''];\n\n    for (const [key, config] of Object.entries(model.parameters)) {\n      const required = config.required ? ' (required)' : '';\n      const defaultStr = config.default !== undefined ? ` [default: ${config.default}]` : '';\n      const rangeStr =\n        config.min !== undefined && config.max !== undefined\n          ? ` [${config.min}-${config.max}]`\n          : '';\n\n      lines.push(`--${key}${required}${defaultStr}${rangeStr}`);\n      if (config.description) {\n        lines.push(`  ${config.description}`);\n      }\n    }\n\n    return lines.join('\\n');\n  }\n}\n", "// ============================================================================\n// R2 Storage Service - Upload, retrieve, and manage generated images\n// Auto-delete after configured expiry period\n// ============================================================================\n\nimport type { Env, ImageMetadata } from '../types.js';\n\nexport class R2StorageService {\n  private bucket: R2Bucket;\n  private expiryHours: number;\n  private cdnUrl: string;\n  private accountId: string;\n\n  constructor(env: Env) {\n    this.bucket = env.IMAGE_BUCKET;\n    this.expiryHours = parseInt(env.IMAGE_EXPIRY_HOURS || '24', 10);\n    this.cdnUrl = env.CDN_URL || '';\n    this.accountId = env.CLOUDFLARE_ACCOUNT_ID;\n  }\n\n  /**\n   * Upload generated image to R2\n   */\n  async uploadImage(\n    imageData: string | ArrayBuffer,\n    metadata: Omit<ImageMetadata, 'id' | 'expiresAt' | 'createdAt'>\n  ): Promise<{ id: string; url: string; expiresAt: number }> {\n    const id = this.generateId();\n    const timestamp = Date.now();\n    const expiresAt = timestamp + this.expiryHours * 60 * 60 * 1000;\n\n    const fullMetadata: ImageMetadata = {\n      ...metadata,\n      id,\n      createdAt: timestamp,\n      expiresAt,\n    };\n\n    // Convert base64 to ArrayBuffer if needed\n    let body: ArrayBuffer;\n    if (typeof imageData === 'string') {\n      // Check if it's a data URI\n      if (imageData.startsWith('data:')) {\n        const base64 = imageData.split(',')[1];\n        body = this.base64ToArrayBuffer(base64);\n      } else {\n        body = this.base64ToArrayBuffer(imageData);\n      }\n    } else {\n      body = imageData;\n    }\n\n    // Generate key with date-based prefix for organization\n    const datePrefix = new Date(timestamp).toISOString().split('T')[0];\n    const key = `images/${datePrefix}/${id}.png`;\n\n    // Upload to R2\n    await this.bucket.put(key, body, {\n      httpMetadata: {\n        contentType: 'image/png',\n        cacheControl: `public, max-age=${this.expiryHours * 3600}`,\n      },\n      customMetadata: {\n        model: fullMetadata.model,\n        prompt: fullMetadata.prompt.substring(0, 500), // Truncate for metadata\n        createdAt: String(fullMetadata.createdAt),\n        expiresAt: String(fullMetadata.expiresAt),\n      },\n    });\n\n    // Generate URL - use worker proxy to avoid CORS/CORB issues\n    // The worker proxy serves images at /images/{key} path\n    const url = `/${key}`;\n\n    return { id, url, expiresAt };\n  }\n\n  /**\n   * Retrieve image metadata\n   */\n  async getImage(id: string): Promise<{ metadata: ImageMetadata; data: ArrayBuffer } | null> {\n    // Search for the image (note: in production, you'd want an index)\n    const listed = await this.bucket.list({\n      prefix: 'images/',\n      limit: 100,\n    });\n\n    const matchingObject = listed.objects.find((obj) => obj.key.includes(id));\n    if (!matchingObject) {\n      return null;\n    }\n\n    const object = await this.bucket.get(matchingObject.key);\n    if (!object) {\n      return null;\n    }\n\n    const custom = object.customMetadata || {};\n    const metadata: ImageMetadata = {\n      id,\n      model: custom.model,\n      prompt: custom.prompt,\n      createdAt: parseInt(custom.createdAt, 10),\n      expiresAt: parseInt(custom.expiresAt, 10),\n      parameters: {},\n    };\n\n    return {\n      metadata,\n      data: await object.arrayBuffer(),\n    };\n  }\n\n  /**\n   * Delete expired images\n   */\n  async cleanupExpired(): Promise<number> {\n    const now = Date.now();\n    let deleted = 0;\n    let cursor: string | undefined = undefined;\n\n    do {\n      const listOptions: R2ListOptions = {\n        prefix: 'images/',\n        limit: 1000,\n      };\n      if (cursor) {\n        listOptions.cursor = cursor;\n      }\n\n      const listed = await this.bucket.list(listOptions);\n\n      const expiredKeys: string[] = [];\n\n      for (const obj of listed.objects) {\n        const custom = obj.customMetadata || {};\n        const expiresAt = parseInt(custom.expiresAt, 10);\n\n        if (expiresAt < now) {\n          expiredKeys.push(obj.key);\n        }\n      }\n\n      if (expiredKeys.length > 0) {\n        await this.bucket.delete(expiredKeys);\n        deleted += expiredKeys.length;\n      }\n\n      // Handle cursor for truncated results\n      if (listed.truncated && 'cursor' in listed) {\n        cursor = (listed as any).cursor;\n      } else {\n        cursor = undefined;\n      }\n    } while (cursor !== undefined);\n\n    return deleted;\n  }\n\n  /**\n   * List all images (with pagination)\n   */\n  async listImages(options: { limit?: number; prefix?: string } = {}): Promise<{\n    images: Array<{ id: string; url: string; createdAt: number; expiresAt: number }>;\n    truncated: boolean;\n    cursor?: string;\n  }> {\n    const listOptions: R2ListOptions = {\n      prefix: options.prefix || 'images/',\n      limit: options.limit || 100,\n    };\n\n    const listed = await this.bucket.list(listOptions);\n\n    const images = listed.objects.map((obj) => {\n      const custom = obj.customMetadata || {};\n      const id = this.extractIdFromKey(obj.key);\n\n      return {\n        id,\n        url: `/${obj.key}`, // Use worker proxy for CORS compatibility\n        createdAt: parseInt(custom.createdAt, 10),\n        expiresAt: parseInt(custom.expiresAt, 10),\n      };\n    });\n\n    // Handle cursor for truncated results\n    let cursor: string | undefined = undefined;\n    if (listed.truncated && 'cursor' in listed) {\n      cursor = (listed as any).cursor;\n    }\n\n    return {\n      images,\n      truncated: listed.truncated,\n      cursor,\n    };\n  }\n\n  /**\n   * Delete a specific image\n   */\n  async deleteImage(id: string): Promise<boolean> {\n    const listed = await this.bucket.list({\n      prefix: 'images/',\n      limit: 100,\n    });\n\n    const matchingObject = listed.objects.find((obj) => obj.key.includes(id));\n    if (!matchingObject) {\n      return false;\n    }\n\n    await this.bucket.delete(matchingObject.key);\n    return true;\n  }\n\n  /**\n   * Get storage statistics\n   */\n  async getStats(): Promise<{\n    totalImages: number;\n    totalSize: number;\n    oldestImage?: number;\n    newestImage?: number;\n  }> {\n    let total = 0;\n    let size = 0;\n    let oldest: number | undefined;\n    let newest: number | undefined;\n    let cursor: string | undefined = undefined;\n\n    do {\n      const listOptions: R2ListOptions = {\n        prefix: 'images/',\n        limit: 1000,\n      };\n      if (cursor) {\n        listOptions.cursor = cursor;\n      }\n\n      const listed = await this.bucket.list(listOptions);\n\n      for (const obj of listed.objects) {\n        total++;\n        size += obj.size;\n\n        const custom = obj.customMetadata || {};\n        const createdAt = parseInt(custom.createdAt, 10);\n\n        if (!oldest || createdAt < oldest) oldest = createdAt;\n        if (!newest || createdAt > newest) newest = createdAt;\n      }\n\n      // Handle cursor for truncated results\n      if (listed.truncated && 'cursor' in listed) {\n        cursor = (listed as any).cursor;\n      } else {\n        cursor = undefined;\n      }\n    } while (cursor !== undefined);\n\n    return { totalImages: total, totalSize: size, oldestImage: oldest, newestImage: newest };\n  }\n\n  // ===== Helper Methods =====\n\n  private generateId(): string {\n    const timestamp = Date.now().toString(36);\n    const random = Math.random().toString(36).substring(2, 10);\n    return `${timestamp}-${random}`;\n  }\n\n  private extractIdFromKey(key: string): string {\n    // Extract ID from key like \"images/2024-01-26/abc123-xyz789.png\"\n    const match = key.match(/images\\/[\\d-]+\\/([^.]+)\\.png/);\n    return match ? match[1] : key;\n  }\n\n  private base64ToArrayBuffer(base64: string): ArrayBuffer {\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes.buffer;\n  }\n}\n", "// ============================================================================\n// Model Configurations - Central configuration for all supported models\n// ============================================================================\n\nimport type { ModelConfig } from '../types.js';\n\nexport const MODEL_CONFIGS: Record<string, ModelConfig> = {\n  '@cf/black-forest-labs/flux-1-schnell': {\n    id: '@cf/black-forest-labs/flux-1-schnell',\n    name: 'FLUX.1 [schnell]',\n    description: 'Fast 12B parameter rectified flow transformer for rapid image generation',\n    provider: 'black-forest-labs',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'base64',\n    supportedTasks: ['text-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      steps: { cfParam: 'steps', type: 'integer', default: 4, min: 1, max: 8 },\n      seed: { cfParam: 'seed', type: 'integer' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 4,\n      maxSteps: 8,\n      minWidth: 512,\n      maxWidth: 2048,\n      minHeight: 512,\n      maxHeight: 2048,\n      supportedSizes: ['512x512', '768x768', '1024x1024'],\n    },\n  },\n  '@cf/black-forest-labs/flux-2-klein-4b': {\n    id: '@cf/black-forest-labs/flux-2-klein-4b',\n    name: 'FLUX.2 [klein]',\n    description: 'Ultra-fast distilled model unifying image generation and editing',\n    provider: 'black-forest-labs',\n    apiVersion: 2,\n    inputFormat: 'multipart',\n    responseFormat: 'base64',\n    supportedTasks: ['text-to-image', 'image-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      steps: { cfParam: 'steps', type: 'integer', default: 4, min: 1, max: 50 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      image: { cfParam: 'image', type: 'string' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 4,\n      maxSteps: 50,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['256x256', '512x512', '768x768', '1024x1024', '1280x1280'],\n    },\n  },\n  '@cf/black-forest-labs/flux-2-dev': {\n    id: '@cf/black-forest-labs/flux-2-dev',\n    name: 'FLUX.2 [dev]',\n    description: 'High-quality image model with multi-reference support',\n    provider: 'black-forest-labs',\n    apiVersion: 2,\n    inputFormat: 'multipart',\n    responseFormat: 'base64',\n    supportedTasks: ['text-to-image', 'image-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      steps: { cfParam: 'steps', type: 'integer', default: 20, min: 1, max: 50 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      image: { cfParam: 'image', type: 'string' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 20,\n      maxSteps: 50,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['256x256', '512x512', '768x768', '1024x1024', '1280x1280'],\n    },\n  },\n  '@cf/stabilityai/stable-diffusion-xl-base-1.0': {\n    id: '@cf/stabilityai/stable-diffusion-xl-base-1.0',\n    name: 'Stable Diffusion XL Base 1.0',\n    description: 'High-quality diffusion model by Stability AI',\n    provider: 'stabilityai',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['text-to-image', 'image-to-image', 'inpainting'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 20, min: 1, max: 20 },\n      guidance: { cfParam: 'guidance', type: 'number', default: 7.5, min: 1, max: 30 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      image_b64: { cfParam: 'image_b64', type: 'string' },\n      mask: { cfParam: 'mask', type: 'string' },\n      strength: { cfParam: 'strength', type: 'number', default: 1, min: 0, max: 1 },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 20,\n      maxSteps: 20,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['256x256', '512x512', '768x768', '1024x1024', '1280x1280', '1024x1792', '1792x1024'],\n    },\n  },\n  '@cf/bytedance/stable-diffusion-xl-lightning': {\n    id: '@cf/bytedance/stable-diffusion-xl-lightning',\n    name: 'SDXL Lightning',\n    description: 'Lightning-fast SDXL model for high-quality 1024px images',\n    provider: 'bytedance',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['text-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 4, min: 1, max: 20 },\n      guidance: { cfParam: 'guidance', type: 'number', default: 7.5, min: 1, max: 30 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 4,\n      maxSteps: 20,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['512x512', '1024x1024'],\n    },\n  },\n  '@cf/lykon/dreamshaper-8-lcm': {\n    id: '@cf/lykon/dreamshaper-8-lcm',\n    name: 'DreamShaper 8 LCM',\n    description: 'Enhanced photorealistic SD model with LCM acceleration',\n    provider: 'lykon',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['text-to-image', 'image-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 8, min: 1, max: 20 },\n      guidance: { cfParam: 'guidance', type: 'number', default: 7.5, min: 1, max: 30 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      image_b64: { cfParam: 'image_b64', type: 'string' },\n      strength: { cfParam: 'strength', type: 'number', default: 1, min: 0, max: 1 },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 8,\n      maxSteps: 20,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['512x512', '768x768', '1024x1024'],\n    },\n  },\n  '@cf/leonardo/lucid-origin': {\n    id: '@cf/leonardo/lucid-origin',\n    name: 'Lucid Origin',\n    description: 'Leonardo.AI\\'s most adaptable and prompt-responsive model',\n    provider: 'leonardo',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'base64',\n    supportedTasks: ['text-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      guidance: { cfParam: 'guidance', type: 'number', default: 4.5, min: 0, max: 10 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1120, min: 256, max: 2500, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1120, min: 256, max: 2500, step: 64 },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 4, min: 1, max: 40 },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 4,\n      maxSteps: 40,\n      minWidth: 256,\n      maxWidth: 2500,\n      minHeight: 256,\n      maxHeight: 2500,\n      supportedSizes: ['512x512', '768x768', '1024x1024', '1280x720', '720x1280'],\n    },\n  },\n  '@cf/leonardo/phoenix-1.0': {\n    id: '@cf/leonardo/phoenix-1.0',\n    name: 'Phoenix 1.0',\n    description: 'Leonardo.AI model with exceptional prompt adherence',\n    provider: 'leonardo',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['text-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      guidance: { cfParam: 'guidance', type: 'number', default: 2, min: 2, max: 10 },\n      seed: { cfParam: 'seed', type: 'integer' },\n      width: { cfParam: 'width', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 1024, min: 256, max: 2048, step: 64 },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 25, min: 1, max: 50 },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 25,\n      maxSteps: 50,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['512x512', '768x768', '1024x1024', '1280x1280'],\n    },\n  },\n  '@cf/runwayml/stable-diffusion-v1-5-img2img': {\n    id: '@cf/runwayml/stable-diffusion-v1-5-img2img',\n    name: 'Stable Diffusion 1.5 Img2Img',\n    description: 'Stable Diffusion for image-to-image transformations',\n    provider: 'runwayml',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['image-to-image'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n      width: { cfParam: 'width', type: 'integer', default: 512, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 512, min: 256, max: 2048, step: 64 },\n      image_b64: { cfParam: 'image_b64', type: 'string' },\n      mask_b64: { cfParam: 'mask', type: 'string' },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 20, min: 1, max: 20 },\n      strength: { cfParam: 'strength', type: 'number', default: 1, min: 0, max: 1 },\n      guidance: { cfParam: 'guidance', type: 'number', default: 7.5, min: 1, max: 30 },\n      seed: { cfParam: 'seed', type: 'integer' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 20,\n      maxSteps: 20,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['256x256', '512x512', '768x768', '1024x1024'],\n    },\n  },\n  '@cf/runwayml/stable-diffusion-v1-5-inpainting': {\n    id: '@cf/runwayml/stable-diffusion-v1-5-inpainting',\n    name: 'Stable Diffusion 1.5 Inpainting',\n    description: 'Stable Diffusion for inpainting with mask support',\n    provider: 'runwayml',\n    apiVersion: 2,\n    inputFormat: 'json',\n    responseFormat: 'binary',\n    supportedTasks: ['inpainting'],\n    parameters: {\n      prompt: { cfParam: 'prompt', type: 'string', required: true },\n      negative_prompt: { cfParam: 'negative_prompt', type: 'string', default: '' },\n      width: { cfParam: 'width', type: 'integer', default: 512, min: 256, max: 2048, step: 64 },\n      height: { cfParam: 'height', type: 'integer', default: 512, min: 256, max: 2048, step: 64 },\n      image_b64: { cfParam: 'image_b64', type: 'string' },\n      mask_b64: { cfParam: 'mask', type: 'string' },\n      num_steps: { cfParam: 'num_steps', type: 'integer', default: 20, min: 1, max: 20 },\n      strength: { cfParam: 'strength', type: 'number', default: 1, min: 0, max: 1 },\n      guidance: { cfParam: 'guidance', type: 'number', default: 7.5, min: 1, max: 30 },\n      seed: { cfParam: 'seed', type: 'integer' },\n    },\n    limits: {\n      maxPromptLength: 2048,\n      defaultSteps: 20,\n      maxSteps: 20,\n      minWidth: 256,\n      maxWidth: 2048,\n      minHeight: 256,\n      maxHeight: 2048,\n      supportedSizes: ['256x256', '512x512', '768x768', '1024x1024'],\n    },\n  },\n};\n\nexport const MODEL_ALIASES: Record<string, string> = {\n  'dall-e-3': '@cf/black-forest-labs/flux-1-schnell',\n  'dall-e-2': '@cf/stabilityai/stable-diffusion-xl-base-1.0',\n  'flux-schnell': '@cf/black-forest-labs/flux-1-schnell',\n  'flux-klein': '@cf/black-forest-labs/flux-2-klein-4b',\n  'flux-dev': '@cf/black-forest-labs/flux-2-dev',\n  'sdxl-base': '@cf/stabilityai/stable-diffusion-xl-base-1.0',\n  'sdxl-lightning': '@cf/bytedance/stable-diffusion-xl-lightning',\n  'dreamshaper': '@cf/lykon/dreamshaper-8-lcm',\n  'lucid-origin': '@cf/leonardo/lucid-origin',\n  'phoenix': '@cf/leonardo/phoenix-1.0',\n  'phoenix-1.0': '@cf/leonardo/phoenix-1.0',\n  'sd-1.5-img2img': '@cf/runwayml/stable-diffusion-v1-5-img2img',\n  'sd-1.5-inpainting': '@cf/runwayml/stable-diffusion-v1-5-inpainting',\n};\n\nexport function getModelConfig(modelId: string): ModelConfig | null {\n  // Check if it's an alias\n  const actualId = MODEL_ALIASES[modelId] || modelId;\n  return MODEL_CONFIGS[actualId] || null;\n}\n\nexport function resolveModelId(input: string): string {\n  return MODEL_ALIASES[input] || input;\n}\n\nexport function listModels(): Array<{\n  id: string;\n  name: string;\n  description: string;\n  capabilities: string[];\n  taskTypes: string[];\n}> {\n  return Object.values(MODEL_CONFIGS).map((config) => ({\n    id: config.id,\n    name: config.name,\n    description: config.description,\n    capabilities: Object.keys(config.parameters),\n    taskTypes: config.supportedTasks,\n  }));\n}\n", "// ============================================================================\n// Image Generator Service - Routes to appropriate Cloudflare AI model\n// ============================================================================\n\nimport type { Env, ModelConfig, ParsedParams } from '../types.js';\nimport { ParamParser } from './param-parser.js';\nimport { R2StorageService } from './r2-storage.js';\nimport { MODEL_CONFIGS, MODEL_ALIASES } from '../config/models.js';\n\nexport class ImageGeneratorService {\n  private ai: Ai;\n  private storage: R2StorageService;\n  private models: Map<string, ModelConfig>;\n  private aliases: Map<string, string>;\n\n  constructor(env: Env) {\n    this.ai = env.AI;\n    this.storage = new R2StorageService(env);\n    this.models = new Map(Object.entries(MODEL_CONFIGS));\n    this.aliases = new Map(Object.entries(MODEL_ALIASES));\n  }\n\n  /**\n   * Resolve model ID from alias or direct ID\n   */\n  resolveModelId(input: string): string {\n    // Check if it's an alias\n    if (this.aliases.has(input)) {\n      return this.aliases.get(input)!;\n    }\n    // Check if it's a direct model ID\n    if (this.models.has(input)) {\n      return input;\n    }\n    // Unknown model\n    throw new Error(`Unknown model: ${input}`);\n  }\n\n  /**\n   * Get model configuration by ID\n   */\n  getModelConfig(modelId: string): ModelConfig | null {\n    const actualId = this.resolveModelId(modelId);\n    return this.models.get(actualId) || null;\n  }\n\n  /**\n   * Generate image from text prompt\n   */\n  async generateImage(\n    modelId: string,\n    prompt: string | Record<string, any>,\n    explicitParams: Record<string, any> = {}\n  ): Promise<{\n    success: boolean;\n    imageUrl?: string;\n    imageId?: string;\n    revisedPrompt?: string;\n    error?: string;\n  }> {\n    const model = this.getModelConfig(modelId);\n    if (!model) {\n      return { success: false, error: `Unknown model: ${modelId}` };\n    }\n\n    try {\n      // Parse parameters\n      const params = ParamParser.parse(prompt, explicitParams, model);\n\n      // Build Cloudflare AI payload\n      const payload = ParamParser.toCFPayload(params, model);\n\n      // Run the model\n      let result: any;\n      if (model.inputFormat === 'multipart') {\n        // FLUX 2 models require multipart form data\n        // Build multipart body as ReadableStream\n        const boundary = '----FormBoundary' + Math.random().toString(36).substring(2);\n        const parts: string[] = [];\n\n        for (const [key, value] of Object.entries(payload)) {\n          if (value !== undefined && value !== null) {\n            parts.push(`--${boundary}\\r\\n`);\n            if (key === 'image' && typeof value === 'string' && value.length > 100) {\n              // For image fields in img2img mode\n              const intArray = this.base64ToUint8Array(value);\n              parts.push(`Content-Disposition: form-data; name=\"${key}\"\\r\\n`);\n              parts.push(`Content-Type: image/png\\r\\n\\r\\n`);\n              parts.push(String.fromCharCode(...intArray));\n              parts.push('\\r\\n');\n            } else {\n              parts.push(`Content-Disposition: form-data; name=\"${key}\"\\r\\n\\r\\n`);\n              parts.push(`${String(value)}\\r\\n`);\n            }\n          }\n        }\n        parts.push(`--${boundary}--\\r\\n`);\n\n        const body = new TextEncoder().encode(parts.join(''));\n        const stream = new ReadableStream({\n          start(controller) {\n            controller.enqueue(body);\n            controller.close();\n          },\n        });\n\n        const contentType = `multipart/form-data; boundary=${boundary}`;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        result = await (this.ai as any).run(model.id, {\n          multipart: {\n            body: stream,\n            contentType,\n          },\n        });\n      } else {\n        // Standard JSON format\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        result = await (this.ai as any).run(model.id, payload);\n      }\n\n      // Extract image from response\n      const base64Image = typeof result === 'string' ? result : (result?.image || result);\n      if (!base64Image) {\n        return { success: false, error: 'No image in model response' };\n      }\n\n      // Upload to R2 storage\n      const uploadResult = await this.storage.uploadImage(base64Image, {\n        model: model.id,\n        prompt: params.prompt,\n        parameters: {\n          size: params.size,\n          steps: params.steps,\n          seed: params.seed,\n          guidance: params.guidance,\n          negative_prompt: params.negative_prompt,\n        },\n      });\n\n      return {\n        success: true,\n        imageUrl: uploadResult.url,\n        imageId: uploadResult.id,\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.error(`Image generation failed: ${message}`);\n      return { success: false, error: message };\n    }\n  }\n\n  /**\n   * Generate multiple images\n   */\n  async generateImages(\n    modelId: string,\n    prompt: string | Record<string, any>,\n    n: number = 1,\n    explicitParams: Record<string, any> = {}\n  ): Promise<{\n    success: boolean;\n    images: Array<{ url: string; id: string }>;\n    error?: string;\n  }> {\n    const results: Array<{ url: string; id: string }> = [];\n\n    for (let i = 0; i < n; i++) {\n      const seed = explicitParams.seed ? explicitParams.seed + i : undefined;\n      const result = await this.generateImage(modelId, prompt, {\n        ...explicitParams,\n        seed,\n      });\n\n      if (result.success && result.imageUrl) {\n        results.push({ url: result.imageUrl, id: result.imageId! });\n      } else {\n        return { success: false, images: results, error: result.error };\n      }\n    }\n\n    return { success: true, images: results };\n  }\n\n  /**\n   * Image-to-image transformation\n   */\n  async generateImageToImage(\n    modelId: string,\n    prompt: string | Record<string, any>,\n    imageData: string,\n    strength: number = 0.5,\n    explicitParams: Record<string, any> = {}\n  ): Promise<{\n    success: boolean;\n    imageUrl?: string;\n    imageId?: string;\n    error?: string;\n  }> {\n    const model = this.getModelConfig(modelId);\n    if (!model) {\n      return { success: false, error: `Unknown model: ${modelId}` };\n    }\n\n    if (!model.supportedTasks.includes('image-to-image')) {\n      return { success: false, error: `Model ${modelId} does not support image-to-image` };\n    }\n\n    try {\n      // Parse parameters with image\n      const params = ParamParser.parse(\n        prompt,\n        { ...explicitParams, image: imageData, strength },\n        model\n      );\n\n      // Build payload with image\n      const payload = ParamParser.toCFPayload(params, model);\n\n      // Run the model\n      let result: any;\n      if (model.inputFormat === 'multipart') {\n        const form = new FormData();\n        for (const [key, value] of Object.entries(payload)) {\n          if (value !== undefined && value !== null) {\n            // For image fields, convert base64 to array of integers (0-255)\n            if (key === 'image' && typeof value === 'string') {\n              const intArray = this.base64ToUint8Array(value);\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              form.append(key, intArray as any);\n            } else {\n              form.append(key, String(value));\n            }\n          }\n        }\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        result = await (this.ai as any).run(model.id, {\n          multipart: {\n            body: form,\n            contentType: 'multipart/form-data',\n          },\n        });\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        result = await (this.ai as any).run(model.id, payload);\n      }\n\n      const base64Image = typeof result === 'string' ? result : (result?.image || result);\n      if (!base64Image) {\n        return { success: false, error: 'No image in model response' };\n      }\n\n      const uploadResult = await this.storage.uploadImage(base64Image, {\n        model: model.id,\n        prompt: params.prompt,\n        parameters: {\n          size: params.size,\n          steps: params.steps,\n          seed: params.seed,\n        },\n      });\n\n      return {\n        success: true,\n        imageUrl: uploadResult.url,\n        imageId: uploadResult.id,\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return { success: false, error: message };\n    }\n  }\n\n  /**\n   * Inpainting / image editing with mask\n   */\n  async generateInpaint(\n    modelId: string,\n    prompt: string,\n    imageData: string,\n    maskData: string,\n    explicitParams: Record<string, any> = {}\n  ): Promise<{\n    success: boolean;\n    imageUrl?: string;\n    imageId?: string;\n    error?: string;\n  }> {\n    const model = this.getModelConfig(modelId);\n    if (!model) {\n      return { success: false, error: `Unknown model: ${modelId}` };\n    }\n\n    if (!model.supportedTasks.includes('inpainting')) {\n      return { success: false, error: `Model ${modelId} does not support inpainting` };\n    }\n\n    try {\n      const params = ParamParser.parse(\n        prompt,\n        { ...explicitParams, image: imageData, mask: maskData },\n        model\n      );\n\n      const payload = ParamParser.toCFPayload(params, model);\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const result = await (this.ai as any).run(model.id, payload);\n\n      const base64Image = typeof result === 'string' ? result : (result?.image || result);\n      if (!base64Image) {\n        return { success: false, error: 'No image in model response' };\n      }\n\n      const uploadResult = await this.storage.uploadImage(base64Image, {\n        model: model.id,\n        prompt: params.prompt,\n        parameters: {\n          size: params.size,\n          steps: params.steps,\n          seed: params.seed,\n        },\n      });\n\n      return {\n        success: true,\n        imageUrl: uploadResult.url,\n        imageId: uploadResult.id,\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return { success: false, error: message };\n    }\n  }\n\n  /**\n   * Get list of all available models\n   */\n  listModels(): Array<{\n    id: string;\n    name: string;\n    description: string;\n    capabilities: string[];\n    taskTypes: string[];\n  }> {\n    const models: Array<{\n      id: string;\n      name: string;\n      description: string;\n      capabilities: string[];\n      taskTypes: string[];\n    }> = [];\n\n    for (const [id, config] of this.models) {\n      const capabilities: string[] = [];\n      if (config.parameters.seed) capabilities.push('seed');\n      if (config.parameters.width) capabilities.push('custom-size');\n      if (config.parameters.guidance) capabilities.push('guidance');\n      if (config.parameters.negative_prompt) capabilities.push('negative-prompt');\n\n      models.push({\n        id,\n        name: config.name,\n        description: config.description,\n        capabilities,\n        taskTypes: config.supportedTasks,\n      });\n    }\n\n    return models;\n  }\n\n  /**\n   * Get parameter help for a model\n   */\n  getModelHelp(modelId: string): string {\n    const model = this.getModelConfig(modelId);\n    if (!model) {\n      return `Unknown model: ${modelId}`;\n    }\n    return ParamParser.formatHelp(model);\n  }\n\n  /**\n   * Cleanup expired images\n   */\n  async cleanupExpired(): Promise<number> {\n    return this.storage.cleanupExpired();\n  }\n\n  /**\n   * Convert base64 string to Uint8Array for multipart form data\n   */\n  private base64ToUint8Array(base64: string): Uint8Array {\n    // Handle data URI prefix\n    const data = base64.replace(/^data:image\\/\\w+;base64,/, '');\n\n    // Decode base64 to binary string\n    const binaryString = atob(data);\n\n    // Convert to Uint8Array\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    return bytes;\n  }\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\.wrangler\\\\tmp\\\\bundle-XpX3da\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\.wrangler\\\\tmp\\\\bundle-XpX3da\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\.wrangler\\\\tmp\\\\bundle-XpX3da\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\src\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\tys\\\\Documents\\\\Coding\\\\cloudflare-image-mcp\\\\workers\\\\src\\\\index.ts\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "// ============================================================================\n// Main Worker Entry Point\n// Routes all requests to appropriate handlers\n// ============================================================================\n\nimport type { Env } from './types.js';\nimport { OpenAIEndpoint } from './endpoints/openai-endpoint.js';\nimport { MCPEndpoint } from './endpoints/mcp-endpoint.js';\nimport { serveFrontend } from './endpoints/frontend.js';\nimport { listModels } from './config/models.js';\n\nexport default {\n  async fetch(request: Request, env: Env): Promise<Response> {\n    const url = new URL(request.url);\n    const path = url.pathname;\n\n    // CORS headers for all responses\n    const corsHeaders = {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    };\n\n    // Handle OPTIONS preflight\n    if (request.method === 'OPTIONS') {\n      return new Response(null, { headers: corsHeaders });\n    }\n\n    try {\n      // Route: Frontend\n      if (path === '/' || path === '/index.html') {\n        return serveFrontend();\n      }\n\n      // Route: Health check\n      if (path === '/health') {\n        return new Response(JSON.stringify({\n          status: 'healthy',\n          timestamp: Date.now(),\n          version: '0.1.0',\n        }), {\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n        });\n      }\n\n      // Route: OpenAI-compatible API\n      if (path.startsWith('/v1/')) {\n        const openai = new OpenAIEndpoint(env);\n        return openai.handle(request);\n      }\n\n      // Route: MCP endpoint (handles /mcp, /mcp/message, /mcp/?transport=sse)\n      if (path === '/mcp' || path === '/mcp/message' || path.startsWith('/mcp/')) {\n        const mcp = new MCPEndpoint(env);\n        return mcp.handle(request);\n      }\n\n      // Route: API endpoints\n      if (path === '/api/models') {\n        const models = listModels();\n        return new Response(JSON.stringify(models), {\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n        });\n      }\n\n      // Route: Image proxy (serve images from R2 through the worker)\n      if (path.startsWith('/images/')) {\n        const imageKey = path.substring(1); // Remove leading slash\n        try {\n          const image = await env.IMAGE_BUCKET.get(imageKey);\n          if (!image) {\n            return new Response('Image not found', { status: 404 });\n          }\n          return new Response(image.body, {\n            headers: {\n              'Content-Type': image.httpMetadata?.contentType || 'image/png',\n              'Cache-Control': 'public, max-age=86400',\n            },\n          });\n        } catch (error) {\n          return new Response('Error fetching image', { status: 500 });\n        }\n      }\n\n      // 404 for unknown routes\n      return new Response(JSON.stringify({ error: 'Not found' }), {\n        status: 404,\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n      });\n\n    } catch (error) {\n      console.error('Worker error:', error);\n      return new Response(JSON.stringify({\n        error: 'Internal server error',\n        message: error instanceof Error ? error.message : String(error),\n      }), {\n        status: 500,\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n  },\n\n  // Scheduled task for cleanup (cron job)\n  async scheduled(controller: ScheduledController, env: Env): Promise<void> {\n    if (controller.cron === '0 * * * *') { // Every hour\n      const { ImageGeneratorService } = await import('./services/image-generator.js');\n      const generator = new ImageGeneratorService(env);\n      const deleted = await generator.cleanupExpired();\n      console.log(`Cleaned up ${deleted} expired images`);\n    }\n  },\n} satisfies ExportedHandler<Env>;\n", "// ============================================================================\n// OpenAI-Compatible REST API Endpoint\n// Implements /v1/images/generations, /v1/images/edits, /v1/images/variations\n// ============================================================================\n\nimport type { Env, OpenAIGenerationRequest, OpenAIEditRequest, OpenAIVariationRequest, OpenAIImageResponse } from '../types.js';\nimport { ImageGeneratorService } from '../services/image-generator.js';\n\nexport class OpenAIEndpoint {\n  private generator: ImageGeneratorService;\n  private corsHeaders: Record<string, string>;\n\n  constructor(env: Env) {\n    this.generator = new ImageGeneratorService(env);\n    this.corsHeaders = {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    };\n  }\n\n  /**\n   * Handle incoming request\n   */\n  async handle(request: Request): Promise<Response> {\n    const url = new URL(request.url);\n    const path = url.pathname;\n\n    // CORS preflight\n    if (request.method === 'OPTIONS') {\n      return new Response(null, { headers: this.corsHeaders });\n    }\n\n    try {\n      // Route to handler\n      if (path === '/v1/images/generations' && request.method === 'POST') {\n        return this.handleGenerations(request);\n      }\n      if (path === '/v1/images/edits' && request.method === 'POST') {\n        return this.handleEdits(request);\n      }\n      if (path === '/v1/images/variations' && request.method === 'POST') {\n        return this.handleVariations(request);\n      }\n      if (path === '/v1/models' && request.method === 'GET') {\n        return this.handleListModels();\n      }\n      if (path === '/v1/models/:model' && request.method === 'GET') {\n        const modelId = url.pathname.split('/').pop() || '';\n        return this.handleDescribeModel(modelId);\n      }\n\n      return new Response(JSON.stringify({ error: 'Not found' }), {\n        status: 404,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    } catch (error) {\n      return this.errorResponse(error);\n    }\n  }\n\n  /**\n   * POST /v1/images/generations\n   * Text-to-image generation (OpenAI-compatible)\n   */\n  private async handleGenerations(request: Request): Promise<Response> {\n    const body = await request.json();\n    const req = body as OpenAIGenerationRequest;\n\n    // Validate required fields\n    if (!req.prompt) {\n      return new Response(JSON.stringify({\n        error: {\n          message: 'prompt is required',\n          type: 'invalid_request_error',\n          param: 'prompt',\n          code: null,\n        },\n      }), {\n        status: 400,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Resolve model ID\n    const modelId = this.generator.resolveModelId(req.model || 'flux-schnell');\n    const n = req.n || 1;\n\n    // Generate images\n    const result = await this.generator.generateImages(\n      modelId,\n      req.prompt,\n      Math.min(n, 8), // Cap at 8 images\n      {\n        size: req.size,\n        steps: (req as any).steps,\n        seed: (req as any).seed,\n        guidance: (req as any).guidance,\n        negative_prompt: (req as any).negative_prompt,\n      }\n    );\n\n    if (!result.success) {\n      return new Response(JSON.stringify({\n        error: { message: result.error, type: 'api_error' },\n      }), {\n        status: 500,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Build response\n    const response: OpenAIImageResponse = {\n      created: Math.floor(Date.now() / 1000),\n      data: result.images.map((img) => ({\n        url: img.url,\n        b64_json: undefined,\n      })),\n    };\n\n    // Handle response_format\n    if (req.response_format === 'b64_json') {\n      response.data = result.images.map((img) => ({\n        b64_json: img.url.split(',').pop() || '', // Extract base64 from data URI\n        url: undefined,\n      }));\n    }\n\n    return new Response(JSON.stringify(response), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * POST /v1/images/edits\n   * Image editing / inpainting (OpenAI-compatible)\n   */\n  private async handleEdits(request: Request): Promise<Response> {\n    const contentType = request.headers.get('content-type') || '';\n\n    let imageData: string;\n    let maskData: string | undefined;\n    let prompt: string;\n    let modelId: string;\n    let n: number;\n    let size: string;\n\n    if (contentType.includes('multipart/form-data')) {\n      const formData = await request.formData();\n      imageData = formData.get('image') as string;\n      maskData = formData.get('mask') as string || undefined;\n      prompt = formData.get('prompt') as string;\n      modelId = this.generator.resolveModelId((formData.get('model') as string) || 'sdxl-base');\n      n = parseInt(formData.get('n') as string) || 1;\n      size = (formData.get('size') as string) || '1024x1024';\n    } else {\n      const body = await request.json();\n      const req = body as OpenAIGenerationRequest;\n      imageData = (req as any).image;\n      maskData = (req as any).mask;\n      prompt = req.prompt;\n      modelId = this.generator.resolveModelId(req.model || 'sdxl-base');\n      n = req.n || 1;\n      size = req.size || '1024x1024';\n    }\n\n    if (!imageData || !prompt) {\n      return new Response(JSON.stringify({\n        error: { message: 'image and prompt are required', type: 'invalid_request_error' },\n      }), {\n        status: 400,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Generate edit\n    let result;\n    if (maskData) {\n      // Inpainting\n      result = await this.generator.generateInpaint(\n        modelId,\n        prompt,\n        imageData,\n        maskData,\n        { size, n }\n      );\n    } else {\n      // Image-to-image\n      result = await this.generator.generateImageToImage(\n        modelId,\n        prompt,\n        imageData,\n        0.5, // Default strength\n        { size, n }\n      );\n    }\n\n    if (!result.success) {\n      return new Response(JSON.stringify({\n        error: { message: result.error, type: 'api_error' },\n      }), {\n        status: 500,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    const response: OpenAIImageResponse = {\n      created: Math.floor(Date.now() / 1000),\n      data: [{\n        url: result.imageUrl,\n      }],\n    };\n\n    return new Response(JSON.stringify(response), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * POST /v1/images/variations\n   * Image variations (OpenAI-compatible)\n   */\n  private async handleVariations(request: Request): Promise<Response> {\n    const contentType = request.headers.get('content-type') || '';\n\n    let imageData: string;\n    let modelId: string;\n    let n: number;\n    let size: string;\n\n    if (contentType.includes('multipart/form-data')) {\n      const formData = await request.formData();\n      imageData = formData.get('image') as string;\n      modelId = this.generator.resolveModelId((formData.get('model') as string) || 'flux-klein');\n      n = parseInt(formData.get('n') as string) || 1;\n      size = (formData.get('size') as string) || '1024x1024';\n    } else {\n      const body = await request.json();\n      const req = body as OpenAIVariationRequest;\n      imageData = req.image;\n      modelId = this.generator.resolveModelId(req.model || 'flux-klein');\n      n = req.n || 1;\n      size = req.size || '1024x1024';\n    }\n\n    if (!imageData) {\n      return new Response(JSON.stringify({\n        error: { message: 'image is required', type: 'invalid_request_error' },\n      }), {\n        status: 400,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Generate variation (uses image-to-image with empty prompt or similar)\n    const result = await this.generator.generateImageToImage(\n      modelId,\n      '', // Empty prompt for variations\n      imageData,\n      0.7, // Lower strength for more faithful variations\n      { size, n }\n    );\n\n    if (!result.success) {\n      return new Response(JSON.stringify({\n        error: { message: result.error, type: 'api_error' },\n      }), {\n        status: 500,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n\n    const response: OpenAIImageResponse = {\n      created: Math.floor(Date.now() / 1000),\n      data: [{\n        url: result.imageUrl,\n      }],\n    };\n\n    return new Response(JSON.stringify(response), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * GET /v1/models\n   * List available models\n   */\n  private handleListModels(): Response {\n    const models = this.generator.listModels();\n\n    return new Response(JSON.stringify({\n      data: models.map((m) => ({\n        id: m.id,\n        object: 'model',\n        created: Math.floor(Date.now() / 1000),\n        owned_by: m.id.split('/')[0],\n      })),\n      object: 'list',\n    }), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * GET /v1/models/:model\n   * Describe a specific model\n   */\n  private handleDescribeModel(modelId: string): Response {\n    const help = this.generator.getModelHelp(modelId);\n\n    return new Response(JSON.stringify({\n      id: modelId,\n      object: 'model',\n      created: Math.floor(Date.now() / 1000),\n      owned_by: modelId.split('/')[0],\n      description: help,\n    }), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Create error response\n   */\n  private errorResponse(error: unknown): Response {\n    const message = error instanceof Error ? error.message : String(error);\n    return new Response(JSON.stringify({\n      error: {\n        message,\n        type: 'api_error',\n        code: null,\n      },\n    }), {\n      status: 500,\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n}\n", "// ============================================================================\n// HTTP MCP Server Endpoint\n// Implements streamable MCP protocol over HTTP\n// ============================================================================\n\nimport type { Env } from '../types.js';\nimport { ImageGeneratorService } from '../services/image-generator.js';\n\nexport class MCPEndpoint {\n  private generator: ImageGeneratorService;\n  private corsHeaders: Record<string, string>;\n\n  constructor(env: Env) {\n    this.generator = new ImageGeneratorService(env);\n    this.corsHeaders = {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization, MCP-Transport',\n    };\n  }\n\n  /**\n   * Handle MCP request\n   */\n  async handle(request: Request): Promise<Response> {\n    const url = new URL(request.url);\n    const pathname = url.pathname;\n\n    // CORS preflight\n    if (request.method === 'OPTIONS') {\n      return new Response(null, { headers: this.corsHeaders });\n    }\n\n    // GET /mcp - Return endpoint info (for human-readable API discovery)\n    if (request.method === 'GET' && pathname === '/mcp') {\n      return this.handleInfo();\n    }\n\n    // GET for SSE transport connection (?transport=sse)\n    if (request.method === 'GET' && url.searchParams.get('transport') === 'sse') {\n      return this.handleSSE(request);\n    }\n\n    // POST for MCP messages (handles both /mcp and /mcp/message for Streamable HTTP)\n    if (request.method === 'POST' && (pathname === '/mcp' || pathname === '/mcp/message')) {\n      return this.handleMessage(request);\n    }\n\n    return new Response(JSON.stringify({ error: 'Not found' }), {\n      status: 404,\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Handle info request for /mcp endpoint\n   */\n  private handleInfo(): Response {\n    const info = {\n      name: 'cloudflare-image-mcp',\n      version: '0.1.0',\n      protocol: 'MCP',\n      transport: 'streamable-http',\n      endpoints: {\n        message: '/mcp/message',\n        sse: '/mcp?transport=sse',\n      },\n      tools: ['generate_image', 'list_models', 'describe_model'],\n      description: 'Image generation using Cloudflare Workers AI',\n    };\n\n    return new Response(JSON.stringify(info, null, 2), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Handle SSE transport connection\n   */\n  private async handleSSE(request: Request): Promise<Response> {\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      start(controller) {\n        // Send initial connection message\n        const data = JSON.stringify({\n          jsonrpc: '2.0',\n          method: 'notifications/initialized',\n          params: {},\n        });\n        controller.enqueue(encoder.encode(`data: ${data}\\n\\n`));\n      },\n    });\n\n    return new Response(stream, {\n      headers: {\n        ...this.corsHeaders,\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        Connection: 'keep-alive',\n      },\n    });\n  }\n\n  /**\n   * Handle MCP JSON-RPC message\n   */\n  private async handleMessage(request: Request): Promise<Response> {\n    try {\n      const message: { id?: string | number; method?: string } = await request.json();\n\n      // Handle different message types\n      if (message.method === 'initialize') {\n        return this.handleInitialize(message);\n      }\n\n      if (message.method === 'notifications/listChanged') {\n        return this.handleListChanged(message);\n      }\n\n      if (message.method === 'tools/list') {\n        return this.handleListTools(message);\n      }\n\n      if (message.method === 'tools/call') {\n        return this.handleCallTool(message);\n      }\n\n      return new Response(JSON.stringify({\n        jsonrpc: '2.0',\n        id: message.id ?? null,\n        error: { code: -32600, message: 'Unknown method' },\n      }), {\n        status: 200,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    } catch {\n      return new Response(JSON.stringify({\n        jsonrpc: '2.0',\n        id: null,\n        error: { code: -32600, message: 'Invalid JSON' },\n      }), {\n        status: 200,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n  }\n\n  /**\n   * Handle initialize request\n   */\n  private handleInitialize(message: any): Response {\n    return new Response(JSON.stringify({\n      jsonrpc: '2.0',\n      id: message.id,\n      result: {\n        protocolVersion: '2024-11-05',\n        capabilities: {\n          tools: {},\n        },\n        serverInfo: {\n          name: 'cloudflare-image-mcp',\n          version: '0.1.0',\n        },\n      },\n    }), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Handle notifications/listChanged\n   */\n  private handleListChanged(message: any): Response {\n    return new Response(JSON.stringify({\n      jsonrpc: '2.0',\n      id: message.id,\n      result: null,\n    }), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Handle tools/list request\n   */\n  private handleListTools(message: any): Response {\n    const tools = this.getToolDefinitions();\n\n    return new Response(JSON.stringify({\n      jsonrpc: '2.0',\n      id: message.id,\n      result: { tools },\n    }), {\n      headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n\n  /**\n   * Handle tools/call request\n   */\n  private async handleCallTool(message: any): Promise<Response> {\n    const { name, arguments: args } = message.params || {};\n\n    try {\n      let result;\n\n      if (name === 'generate_image') {\n        result = await this.handleGenerateImage(args);\n      } else if (name === 'list_models') {\n        result = await this.handleListModels(args);\n      } else if (name === 'describe_model') {\n        result = await this.handleDescribeModel(args);\n      } else {\n        return new Response(JSON.stringify({\n          jsonrpc: '2.0',\n          id: message.id,\n          error: { code: -32601, message: `Unknown tool: ${name}` },\n        }), {\n          status: 200,\n          headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n        });\n      }\n\n      return new Response(JSON.stringify({\n        jsonrpc: '2.0',\n        id: message.id,\n        result: { content: result },\n      }), {\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      return new Response(JSON.stringify({\n        jsonrpc: '2.0',\n        id: message.id,\n        error: { code: -32603, message: errorMessage },\n      }), {\n        status: 200,\n        headers: { ...this.corsHeaders, 'Content-Type': 'application/json' },\n      });\n    }\n  }\n\n  /**\n   * Handle generate_image tool call\n   */\n  private async handleGenerateImage(args: any): Promise<any[]> {\n    const {\n      prompt,\n      model,\n      n,\n      size,\n      steps,\n      seed,\n      guidance,\n      negative_prompt,\n    } = args || {};\n\n    if (!prompt) {\n      return [{\n        type: 'text',\n        text: 'Error: prompt is required',\n        isError: true,\n      }];\n    }\n\n    const modelId = this.generator.resolveModelId(model || 'flux-schnell');\n    const numImages = n || 1;\n\n    const result = await this.generator.generateImages(\n      modelId,\n      prompt,\n      Math.min(numImages, 8),\n      {\n        size,\n        steps,\n        seed,\n        guidance,\n        negative_prompt,\n      }\n    );\n\n    if (!result.success) {\n      return [{\n        type: 'text',\n        text: `Error: ${result.error}`,\n        isError: true,\n      }];\n    }\n\n    // Format response\n    const textParts: string[] = [];\n\n    if (result.images.length === 1) {\n      textParts.push(`Image generated successfully!\\n`);\n      textParts.push(`![Generated Image](${result.images[0].url})`);\n    } else {\n      textParts.push(`Generated ${result.images.length} images:\\n\\n`);\n      result.images.forEach((img, i) => {\n        textParts.push(`Image ${i + 1}: ![Generated Image ${i + 1}](${img.url})\\n`);\n      });\n    }\n\n    return [{\n      type: 'text',\n      text: textParts.join('\\n'),\n    }];\n  }\n\n  /**\n   * Handle list_models tool call\n   */\n  private async handleListModels(_args: any): Promise<any[]> {\n    const models = this.generator.listModels();\n\n    let text = 'Available Image Generation Models:\\n\\n';\n    text += '| Model | Capabilities | Task Types |\\n';\n    text += '|-------|--------------|------------|\\n';\n\n    for (const model of models) {\n      text += `| **${model.name}** (${model.id}) | ${model.capabilities.join(', ') || 'basic'} | ${model.taskTypes.join(', ')} |\\n`;\n    }\n\n    return [{\n      type: 'text',\n      text,\n    }];\n  }\n\n  /**\n   * Handle describe_model tool call\n   */\n  private async handleDescribeModel(args: any): Promise<any[]> {\n    const { model } = args || {};\n\n    if (!model) {\n      return [{\n        type: 'text',\n        text: 'Error: model parameter is required',\n        isError: true,\n      }];\n    }\n\n    const help = this.generator.getModelHelp(model);\n\n    return [{\n      type: 'text',\n      text: help,\n    }];\n  }\n\n  /**\n   * Get tool definitions for MCP\n   */\n  private getToolDefinitions(): any[] {\n    return [\n      {\n        name: 'generate_image',\n        description: 'Generate images using Cloudflare Workers AI models. Supports FLUX, SDXL, Leonardo, and Stable Diffusion models.',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            prompt: {\n              type: 'string',\n              description: 'Text description of the image to generate. You can also embed parameters like --steps=6 --seed=12345',\n            },\n            model: {\n              type: 'string',\n              description: 'Model ID or alias. Options: flux-schnell, flux-klein, flux-dev, sdxl-base, sdxl-lightning, dreamshaper, lucid-origin, phoenix, sd-1.5-img2img, sd-1.5-inpainting',\n              enum: [\n                'flux-schnell',\n                'flux-klein',\n                'flux-dev',\n                'sdxl-base',\n                'sdxl-lightning',\n                'dreamshaper',\n                'lucid-origin',\n                'phoenix',\n                'phoenix-1.0',\n                'sd-1.5-img2img',\n                'sd-1.5-inpainting',\n              ],\n            },\n            n: {\n              type: 'number',\n              description: 'Number of images to generate (1-8)',\n              minimum: 1,\n              maximum: 8,\n            },\n            size: {\n              type: 'string',\n              description: 'Image size (e.g., 1024x1024)',\n            },\n            steps: {\n              type: 'number',\n              description: 'Number of diffusion steps (model-dependent)',\n            },\n            seed: {\n              type: 'number',\n              description: 'Random seed for reproducibility',\n            },\n            guidance: {\n              type: 'number',\n              description: 'Guidance scale (1-30, model-dependent)',\n            },\n            negative_prompt: {\n              type: 'string',\n              description: 'Elements to avoid in the image',\n            },\n          },\n          required: ['prompt'],\n        },\n      },\n      {\n        name: 'list_models',\n        description: 'List all available image generation models with their capabilities',\n        inputSchema: {\n          type: 'object',\n          properties: {},\n        },\n      },\n      {\n        name: 'describe_model',\n        description: 'Get detailed parameter documentation for a specific model',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            model: {\n              type: 'string',\n              description: 'Model ID to describe',\n            },\n          },\n          required: ['model'],\n        },\n      },\n    ];\n  }\n}\n", "// ============================================================================\n// Frontend HTML Template\n// Responsive web UI for image generation\n// ============================================================================\n\nexport function getFrontendHTML(): string {\n  return `<!DOCTYPE html>\n<html lang=\"en\" class=\"light\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Cloudflare AI Image Generator</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css\" rel=\"stylesheet\" crossorigin=\"anonymous\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css\">\n    <style>\n        :root {\n            --primary: #5046e5;\n            --primary-light: #6e67eb;\n            --primary-dark: #4338ca;\n            --secondary: #f0f4f8;\n            --text: #1a202c;\n            --text-light: #4a5568;\n            --background: #ffffff;\n            --card-bg: #f7fafc;\n            --border: #e2e8f0;\n            --success: #10b981;\n            --error: #ef4444;\n            --warning: #f59e0b;\n            --info: #3b82f6;\n        }\n\n        .dark {\n            --primary: #6e67eb;\n            --primary-light: #8a84ee;\n            --primary-dark: #5046e5;\n            --secondary: #2d3748;\n            --text: #f7fafc;\n            --text-light: #cbd5e0;\n            --background: #111827;\n            --card-bg: #1f2937;\n            --border: #374151;\n            --success: #10b981;\n            --error: #ef4444;\n            --warning: #f59e0b;\n            --info: #3b82f6;\n        }\n\n        body {\n            background-color: var(--background);\n            color: var(--text);\n            transition: background-color 0.3s ease, color 0.3s ease;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        }\n\n        .btn {\n            padding: 1rem 1.5rem;\n            border-radius: 0.375rem;\n            transition: all 0.3s;\n        }\n\n        .btn:focus { outline: none; }\n\n        .btn-primary {\n            background-color: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background-color: var(--primary-light);\n            transform: translateY(-1px);\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        }\n\n        .btn-secondary {\n            background-color: var(--secondary);\n            color: var(--text);\n            border: 1px solid var(--border);\n        }\n\n        .btn-secondary:hover {\n            background-color: var(--border);\n            transform: translateY(-1px);\n        }\n\n        .card {\n            background-color: var(--card-bg);\n            border: 1px solid var(--border);\n            border-radius: 0.5rem;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n            transition: all 0.3s ease;\n        }\n\n        .card:hover {\n            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n        }\n\n        input, select, textarea {\n            background-color: var(--background);\n            color: var(--text);\n            border: 1px solid var(--border);\n            border-radius: 0.375rem;\n            padding: 0.5rem 0.75rem;\n            transition: all 0.3s ease;\n            width: 100%;\n        }\n\n        input:focus, select:focus, textarea:focus {\n            outline: none;\n            border-color: var(--primary);\n            box-shadow: 0 0 0 3px rgba(80, 70, 229, 0.1);\n        }\n\n        .slider {\n            -webkit-appearance: none;\n            appearance: none;\n            width: 100%;\n            height: 6px;\n            border-radius: 5px;\n            background: var(--border);\n            outline: none;\n            margin: 10px 0;\n        }\n\n        .slider::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            appearance: none;\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            background: var(--primary);\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n\n        .slider::-webkit-slider-thumb:hover {\n            transform: scale(1.2);\n            box-shadow: 0 0 0 3px rgba(80, 70, 229, 0.2);\n        }\n\n        .loading-mask {\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: rgba(0,0,0,0.6);\n            border-radius: 0.5rem;\n            z-index: 10;\n            backdrop-filter: blur(4px);\n        }\n\n        .image-container {\n            aspect-ratio: 1 / 1;\n            overflow: hidden;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: var(--card-bg);\n            position: relative;\n            border-radius: 0.5rem;\n            max-height: 400px;\n            margin: 0 auto;\n            width: 100%;\n        }\n\n        .hidden { display: none !important; }\n\n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: .5; }\n        }\n\n        .animate-pulse {\n            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n\n        @media (max-width: 768px) {\n            .mobile-flex-col { flex-direction: column; }\n            .container { padding-left: 1rem; padding-right: 1rem; }\n        }\n\n        @media (min-width: 1024px) {\n            .container { max-width: 1200px; }\n        }\n    </style>\n</head>\n<body class=\"min-h-screen py-4\">\n    <div class=\"container mx-auto px-4 py-4 max-w-6xl\">\n        <div class=\"flex items-center justify-between mb-6\">\n            <h1 class=\"text-2xl md:text-3xl font-bold flex items-center\">\n                <i class=\"fa-solid fa-image mr-2\"></i>AI Image Generator\n            </h1>\n            <div class=\"flex items-center space-x-2\">\n                <button id=\"themeToggle\" class=\"btn btn-secondary p-2 h-10 w-10 flex items-center justify-center\" aria-label=\"Toggle dark theme\">\n                    <i class=\"fa-solid fa-moon\"></i>\n                </button>\n            </div>\n        </div>\n\n        <div class=\"flex flex-col lg:flex-row gap-6 mobile-flex-col\">\n            <!-- Left Control Panel -->\n            <div class=\"w-full lg:w-2/5 space-y-4\">\n                <!-- Basic Settings -->\n                <div class=\"card p-4 space-y-4 fade-in\">\n                    <h2 class=\"text-lg font-semibold flex items-center\">\n                        <i class=\"fa-solid fa-sliders mr-2 text-primary\"></i>Settings\n                    </h2>\n\n                    <div>\n                        <label for=\"model\" class=\"block text-sm font-medium mb-1\">\n                            <i class=\"fa-solid fa-robot mr-1\"></i>Model\n                        </label>\n                        <select id=\"model\" class=\"w-full\">\n                            <option value=\"flux-schnell\">FLUX.1 [schnell] - Fast, high quality</option>\n                            <option value=\"flux-klein\">FLUX.2 [klein] - Ultra-fast, supports img2img</option>\n                            <option value=\"flux-dev\">FLUX.2 [dev] - High quality, multi-reference</option>\n                            <option value=\"sdxl-base\">SDXL Base 1.0 - Stable, versatile</option>\n                            <option value=\"sdxl-lightning\">SDXL Lightning - Fast SDXL</option>\n                            <option value=\"dreamshaper\">DreamShaper 8 LCM - Photorealistic</option>\n                            <option value=\"lucid-origin\">Lucid Origin - Leonardo.AI</option>\n                            <option value=\"phoenix\">Phoenix 1.0 - Leonardo.AI</option>\n                        </select>\n                    </div>\n\n                    <div>\n                        <label for=\"prompt\" class=\"block text-sm font-medium mb-1\">\n                            <i class=\"fa-solid fa-wand-magic-sparkles mr-1\"></i>Prompt\n                        </label>\n                        <textarea id=\"prompt\" rows=\"3\" placeholder=\"Describe your image... Use --param=value for additional settings\" class=\"w-full\">cyberpunk cat</textarea>\n                    </div>\n\n                    <div>\n                        <label for=\"negative_prompt\" class=\"block text-sm font-medium mb-1\">\n                            <i class=\"fa-solid fa-ban mr-1\"></i>Negative Prompt\n                        </label>\n                        <textarea id=\"negative_prompt\" rows=\"2\" placeholder=\"Elements to avoid...\" class=\"w-full\"></textarea>\n                    </div>\n                </div>\n\n                <!-- Advanced Options -->\n                <div class=\"card p-4 space-y-4 fade-in\">\n                    <div class=\"flex justify-between items-center\">\n                        <h2 class=\"text-lg font-semibold flex items-center\">\n                            <i class=\"fa-solid fa-gear mr-2 text-primary\"></i>Advanced Options\n                        </h2>\n                        <button id=\"toggleAdvanced\" class=\"text-xs btn btn-secondary py-1 px-3\">\n                            <i class=\"fa-solid fa-chevron-down mr-1\" id=\"advancedIcon\"></i>Show/Hide\n                        </button>\n                    </div>\n\n                    <div id=\"advancedOptions\" class=\"space-y-3 hidden\">\n                        <div>\n                            <div class=\"flex justify-between items-center\">\n                                <label class=\"block text-sm font-medium\">Width</label>\n                                <span id=\"widthValue\" class=\"text-sm font-mono\">1024px</span>\n                            </div>\n                            <input type=\"range\" id=\"width\" min=\"256\" max=\"2048\" step=\"64\" value=\"1024\" class=\"slider w-full\">\n                        </div>\n\n                        <div>\n                            <div class=\"flex justify-between items-center\">\n                                <label class=\"block text-sm font-medium\">Height</label>\n                                <span id=\"heightValue\" class=\"text-sm font-mono\">1024px</span>\n                            </div>\n                            <input type=\"range\" id=\"height\" min=\"256\" max=\"2048\" step=\"64\" value=\"1024\" class=\"slider w-full\">\n                        </div>\n\n                        <div>\n                            <div class=\"flex justify-between items-center\">\n                                <label class=\"block text-sm font-medium\">Steps</label>\n                                <span id=\"stepsValue\" class=\"text-sm font-mono\">4</span>\n                            </div>\n                            <input type=\"range\" id=\"steps\" min=\"1\" max=\"20\" step=\"1\" value=\"4\" class=\"slider w-full\">\n                        </div>\n\n                        <div>\n                            <div class=\"flex justify-between items-center\">\n                                <label class=\"block text-sm font-medium\">Guidance</label>\n                                <span id=\"guidanceValue\" class=\"text-sm font-mono\">7.5</span>\n                            </div>\n                            <input type=\"range\" id=\"guidance\" min=\"1\" max=\"30\" step=\"0.5\" value=\"7.5\" class=\"slider w-full\">\n                        </div>\n\n                        <div>\n                            <label class=\"block text-sm font-medium mb-1\">Seed (leave empty for random)</label>\n                            <div class=\"flex gap-2\">\n                                <input type=\"number\" id=\"seed\" placeholder=\"Random seed\" class=\"w-full\">\n                                <button id=\"randomSeed\" class=\"btn btn-secondary text-sm py-1 px-3\">\n                                    <i class=\"fa-solid fa-random\"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div>\n                            <label class=\"block text-sm font-medium mb-1\">Number of images (1-8)</label>\n                            <input type=\"number\" id=\"n\" min=\"1\" max=\"8\" value=\"1\" class=\"w-full\">\n                        </div>\n                    </div>\n                </div>\n\n                <button id=\"submitButton\" class=\"btn btn-primary w-full py-3 flex items-center justify-center\">\n                    <i class=\"fa-solid fa-wand-magic-sparkles mr-2\"></i>Generate Image\n                </button>\n            </div>\n\n            <!-- Right Image Display -->\n            <div class=\"w-full lg:w-3/5\">\n                <div class=\"card h-full p-4 space-y-4 fade-in\">\n                    <div class=\"flex justify-between items-center\">\n                        <h2 class=\"text-lg font-semibold flex items-center\">\n                            <i class=\"fa-solid fa-image mr-2 text-primary\"></i>Result\n                        </h2>\n                        <div class=\"flex space-x-2\">\n                            <button id=\"copyParamsButton\" class=\"btn btn-secondary text-sm py-1 px-3 hidden\">\n                                <i class=\"fa-solid fa-copy mr-1\"></i>Copy Params\n                            </button>\n                            <button id=\"downloadButton\" class=\"btn btn-secondary text-sm py-1 px-3 hidden\">\n                                <i class=\"fa-solid fa-download mr-1\"></i>Download\n                            </button>\n                        </div>\n                    </div>\n\n                    <div class=\"image-container card\">\n                        <div id=\"loadingOverlay\" class=\"loading-mask hidden\">\n                            <div class=\"text-center\">\n                                <div class=\"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white\"></div>\n                                <p class=\"text-white mt-3 font-medium\">Generating...</p>\n                            </div>\n                        </div>\n                        <div id=\"initialPrompt\" class=\"text-center text-gray-400 dark:text-gray-600\">\n                            <i class=\"fa-solid fa-image-portrait text-4xl mb-2\"></i>\n                            <p>Click generate to create an image</p>\n                        </div>\n                        <img id=\"aiImage\" class=\"max-h-full max-w-full rounded hidden\" alt=\"Generated image\">\n                    </div>\n\n                    <div id=\"imageInfo\" class=\"space-y-3 mt-2\">\n                        <div class=\"grid grid-cols-2 gap-3 text-sm\">\n                            <div><span class=\"font-medium\">Model:</span> <span id=\"usedModel\">-</span></div>\n                            <div><span class=\"font-medium\">Time:</span> <span id=\"generationTime\">-</span></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Configuration\n        const API_BASE = '/v1';\n\n        // State\n        let currentImageUrl = null;\n\n        // DOM Elements\n        const themeToggle = document.getElementById('themeToggle');\n        const html = document.documentElement;\n        const toggleAdvanced = document.getElementById('toggleAdvanced');\n        const advancedOptions = document.getElementById('advancedOptions');\n        const advancedIcon = document.getElementById('advancedIcon');\n        const submitButton = document.getElementById('submitButton');\n        const loadingOverlay = document.getElementById('loadingOverlay');\n        const initialPrompt = document.getElementById('initialPrompt');\n        const aiImage = document.getElementById('aiImage');\n        const downloadButton = document.getElementById('downloadButton');\n\n        // Theme toggle\n        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n            html.classList.add('dark');\n            themeToggle.innerHTML = '<i class=\"fa-solid fa-sun\"></i>';\n        }\n\n        themeToggle.addEventListener('click', () => {\n            if (html.classList.contains('dark')) {\n                html.classList.remove('dark');\n                localStorage.theme = 'light';\n                themeToggle.innerHTML = '<i class=\"fa-solid fa-moon\"></i>';\n            } else {\n                html.classList.add('dark');\n                localStorage.theme = 'dark';\n                themeToggle.innerHTML = '<i class=\"fa-solid fa-sun\"></i>';\n            }\n        });\n\n        // Advanced options toggle\n        toggleAdvanced.addEventListener('click', () => {\n            advancedOptions.classList.toggle('hidden');\n            advancedIcon.classList.toggle('fa-chevron-down');\n            advancedIcon.classList.toggle('fa-chevron-up');\n        });\n\n        // Slider value displays\n        ['width', 'height', 'steps', 'guidance'].forEach(id => {\n            const slider = document.getElementById(id);\n            const valueDisplay = document.getElementById(id + 'Value');\n            slider.addEventListener('input', () => {\n                valueDisplay.textContent = slider.value + (id === 'guidance' ? '' : 'px');\n            });\n        });\n\n        // Random seed\n        document.getElementById('randomSeed').addEventListener('click', () => {\n            document.getElementById('seed').value = Math.floor(Math.random() * 4294967295);\n        });\n\n        // Generate image\n        submitButton.addEventListener('click', async () => {\n            const model = document.getElementById('model').value;\n            const prompt = document.getElementById('prompt').value;\n            const negativePrompt = document.getElementById('negative_prompt').value;\n            const width = document.getElementById('width').value;\n            const height = document.getElementById('height').value;\n            const steps = document.getElementById('steps').value;\n            const guidance = document.getElementById('guidance').value;\n            const seed = document.getElementById('seed').value;\n            const n = document.getElementById('n').value;\n\n            if (!prompt.trim()) {\n                alert('Please enter a prompt');\n                return;\n            }\n\n            // Show loading\n            initialPrompt.classList.add('hidden');\n            aiImage.classList.add('hidden');\n            downloadButton.classList.add('hidden');\n            loadingOverlay.classList.remove('hidden');\n\n            // Capture start time for duration calculation\n            const startTime = Date.now();\n\n            try {\n                const response = await fetch(API_BASE + '/images/generations', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        model: model,\n                        prompt: prompt,\n                        n: parseInt(n),\n                        size: width + 'x' + height,\n                        steps: parseInt(steps),\n                        guidance: parseFloat(guidance),\n                        negative_prompt: negativePrompt,\n                        seed: seed ? parseInt(seed) : undefined,\n                    }),\n                });\n\n                if (!response.ok) {\n                    const error = await response.json();\n                    throw new Error(error.error?.message || 'Generation failed');\n                }\n\n                const data = await response.json();\n                const imageData = data.data[0];\n\n                // Handle b64_json or url\n                let imageUrl;\n                if (imageData.b64_json) {\n                    imageUrl = 'data:image/png;base64,' + imageData.b64_json;\n                } else {\n                    imageUrl = imageData.url;\n                }\n\n                currentImageUrl = imageUrl;\n\n                // Calculate elapsed time\n                const elapsed = Date.now() - startTime;\n                const elapsedSeconds = (elapsed / 1000).toFixed(1);\n\n                // Display image\n                aiImage.src = imageUrl;\n                aiImage.onload = () => {\n                    loadingOverlay.classList.add('hidden');\n                    aiImage.classList.remove('hidden');\n                    downloadButton.classList.remove('hidden');\n\n                    // Update info\n                    document.getElementById('usedModel').textContent = model;\n                    document.getElementById('generationTime').textContent = elapsedSeconds + 's';\n                };\n\n            } catch (error) {\n                loadingOverlay.classList.add('hidden');\n                initialPrompt.classList.remove('hidden');\n                alert('Error: ' + error.message);\n            }\n        });\n\n        // Download image\n        downloadButton.addEventListener('click', async () => {\n            if (!currentImageUrl) return;\n\n            try {\n                const response = await fetch(currentImageUrl);\n                const blob = await response.blob();\n                const url = window.URL.createObjectURL(blob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = 'image-' + Date.now() + '.png';\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                window.URL.revokeObjectURL(url);\n            } catch (error) {\n                alert('Download failed: ' + error.message);\n            }\n        });\n    </script>\n</body>\n</html>`;\n}\n\nexport function serveFrontend(): Response {\n  return new Response(getFrontendHTML(), {\n    headers: {\n      'Content-Type': 'text/html',\n      'Cache-Control': 'no-cache',\n    },\n  });\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": ["ImageGeneratorService"]
}
